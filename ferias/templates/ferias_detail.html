{% extends "base.html" %}
{% load static %}

{% block title %}{{feria.nombre}}{% endblock title %}

{% block styles %}
{% endblock %}
{% block scripts %}
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- ===========  Carousel =========== -->
        <div class="col-md-12" id="carouselSection">
            <div id="carouselImgsFeria" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#carouselImgsFeria" data-bs-slide-to="0" class="active"
                        aria-current="true" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#carouselImgsFeria" data-bs-slide-to="1"
                        aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#carouselImgsFeria" data-bs-slide-to="2"
                        aria-label="Slide 3"></button>
                </div>
                <div class="carousel-inner">
                    <!-- TODO: cambiar cuando se agregue el modelo de Feria -->
                    {% for i in '012'|make_list %}
                    <div class="carousel-item {% if i == '0' %} active {% endif %}">
                        <img src="https://sertacentroamerica.com/costarica/wp-content/uploads/sites/3/2021/05/placeholder-106.png" 
                            class="w-100 d-inline-block" 
                            style="max-height: 40vh;object-fit: cover;"
                            loading="lazy">
                    </div>
                    {% endfor %}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselImgsFeria"
                    data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselImgsFeria"
                    data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
        <!-- ===========  Info Feria =========== -->
        <div class="col-md-4" id="info-feria">
            <h1>{{feria.nombre}}</h1>
            {% if feria.abre_hoy %}
            <span class="badge bg-success">Abre hoy</span>
            {% else %}
            <span class="badge bg-danger">Cerrado hoy</span>
            {% endif %}
            <p class="text-muted">
                <i class="bi bi-geo"></i>
                {{feria.distrito}}, {{feria.canton}}, {{feria.get_provincia_display}}
            </p>
            <small><i class="bi bi-geo-alt"></i> Dirección exacta:</small>
            <p class="text-muted">{{feria.direccion}}</p>
            <small><i class="bi bi-clock"></i> Horario:</small>
            <ul id="horarios-section">
            </ul>
        </div>
        <!-- ===========  Info Productos de la Feria =========== -->
        <div class="col-md-8" id="info-productos">
            {% if feria.oferta.count > 0 %}
            <h5>Productos que se venden en esta feria</h5>
            <div class="row">                
            {% for producto in feria.oferta.all %}
            <!-- ===========  Info de Producto espeficico =========== -->
            <div class="col-md-3">
                <div class="card-feria" >
                    <a href="#" target="_blank">
                        <img src="{{producto.imagen.url}}" loading="lazy"
                            alt="Imagen de {{producto.nombre_comun}}" 
                            class="img-fluid card-img" 
                            style="width:100%;max-height: 100px;object-fit: cover;">
                    </a>
                    <div class="card-feria-container">
                        <a href="#">
                            <h6><b>{{producto.nombre_comun}}</b></h6>
                        </a>
                    </div>
                    </div>
                </div>
            {% endfor %}
            {% else %}
            <br>
            <div class="alert alert-info" role="alert">
                Esta feria no tiene productos asociados comuniquese con el administrador de esta página.
                <a href="#">Contacto</a>
            </div>
            {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block scriptsEnd %}
<script>   
    const horarios = JSON.parse('{{horarios | safe}}');
    const horarioSection = document.getElementById('horarios-section');
    horarios.forEach(dia => {
        let horarioStr = '';
        let li = document.createElement('li');
        horarioStr += dias_dict[dia.fields.dia_inicio] + ': ';
        horarioStr += convertToAMPM(dia.fields.hora_inicio) + ' - ' + convertToAMPM(dia.fields.hora_final);        
        li.innerHTML = horarioStr;
        horarioSection.appendChild(li);
    });
</script>
{% endblock %}